# **《数据库系统原理》**

### 													-- 浙江大学 陈岭

### 数据库与数据库管理系统定义

- 数据库（DB）

  1. 与企业相关的数据集合
  2. 具有完整性和持久性的数据集合
  3. 长期（常常多年）存在的信息集合
  4. 长期存储在计算机内，有组织的，可共享的数据集合

- 数据库管理系统（DBMS）

  数据库 + 一组用以访问，更新和管理这些数据的程序



### DBMS 的主要特性

- 数据访问的高效和可扩展性
- 缩短应用开发时间
- 数据独立性（物理数据独立性/逻辑数据独立性）
- 数据完整性和安全性（沿用数据库的特性）
- 并发访问和鲁棒性（恢复）



### Database System VS File Processing Systems

- 文件处理系统由传统操作系统所支持：

  - 随着需求的增长，需要编写新的应用程序，并创建新的数据文件
  - 但在相当长的时间里，数据文件可以是不同的格式。数据文件是相互独立的

- 在文件处理系统中存储组织信息的弊端

  - 数据冗余和不一致

    多种文件格式，信息重复存储

  - 数据访问困难

    需要编写一个新的程序来完成每一个新的任务

  - 数据孤立

    多文件多格式，检索，共享数据困难（文件处理系统中表内数据无法简单实现关联）

  - 完整性问题

    - 完整性约束（如账户余额 > 0）成为程序代码的一部分，由代码实现约束（无法自动检查）
    - 增加新的约束或者更改现有的约束很困难

  - 原子性问题（数据库的原子性特性）

    - 在进行部分数据更新时，一旦发生故障，可能导致数据库处于不一致的状态
    - 例如，从一个账户转移资金到另一个账户，此操作要么完成，要么根本不会发生（数据库系统中定义“事务”，文件处理系统中类似“锁”）

  - 并发访问异常

    - 为了提高系统的总体性能，许多系统允许并发访问
    - 不受控制的并发访问可能导致数据不一致
    - 例如，两个用户读取同一账号余额，并在同一时间更新它
    
  - 安全性问题
  
    - 并非所有用户都可以访问所有数据（文件处理系统没有权限分级，不像数据库系统存在行可读，表可读）
  
- 数据库系统为以上所有问题，提供了解决方案

### 数据抽象

如何使用数据库系统：不同的用法需要不同层次的抽象和建模（以成绩管理系统为例）

  - 物理层：描述数据实际上是怎样存储的

  - 逻辑层：描述数据库中存储什么数据及这些数据间存在什么关系

    ```sql
    type instructor = record
    	ID: char(5);
    	name: char(20);
    	dept_name: char(20);
    	salary: numeric(8, 2);
    end;
    ```

  - 视图层：应用程序能够隐藏数据类型的详细信息。视图也可以出于安全目的**隐藏数据信息**（例如，员工的薪水存储于独立的一张表）

### 实例和模式

- 类似编程语言中的类型（types）和变量（variables）:

  类型 == 模式；变量 == 实例

- 模式（schema）：数据库的总体设计

  - 类似于程序中变量的类型信息
  - 物理模式：在物理层描述数据库的设计
  - 逻辑模式：在逻辑层描述数据库的设计

- 实例（instance）：特定时刻存储在数据库中的信息的集合，类似于程序中变量的值

### 数据库系统的模式结构

![数据库系统的模式结构](https://raw.githubusercontent.com/MylittleTown/notes/master/Database/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86-%E6%B5%99%E5%A4%A7%E9%99%88%E5%B2%AD/Related_images/%E7%AC%AC%E4%B8%80%E7%AB%A0-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84.png)

### 物理独立性和逻辑独立性

- 修改一层的结构定义不影响更高层的结构定义
- 物理数据独立性：修改物理结构而不需要改变逻辑结构的能力
  - 应用程序依赖于逻辑结构
  - 应用程序独立于数据的结构和存储
- 逻辑数据独立性：数据逻辑结构的改变通过修改模式到外模式的映射从而不影响应用程序
  - 逻辑数据独立性一般难以实现，因为应用程序严重依赖于数据的逻辑结构

### 数据模型

- 数据模型是一个概念工具的集合，用于描述：数据结构，数据关系，数据语义，数据约束
- 数据抽象的不同层次需要不同的数据模型来描述：
  - 实体 - 关系模型（概念设计）
  - 关系模型（逻辑设计）
  - 其他模型（面向对象模型，半结构化数据模型，网状模型和层次模型等）

### 数据库设计步骤

1. 需求分析：需要什么样的数据（数据内容，数据结构），应用程序和业务
2. 概念数据库设计：使用E-R模型或类似的高层次数据模型来描述数据
3. 逻辑数据库设计：将概念设计转换为某个DBMS所支持的逻辑层数据模型，确认概念数据库设计的DBMS对应的类型（schema，模式）
4. 结构优化：关系标准化，检查冗余和相关的异常关系结构
5. 物理数据库设计：索引，集群和数据库调优
6. 创建并初始化数据库 & 安全设计：加载初始数据测试；识别不同的用户及他们的角色

### 实体-联系模型

- E-R （entity - relationship）模型：例如常见的所属关系

- 实体（对象）：例如客户，账户，银行分支机构；实体由属性描述

- 联系：是几个实体之间的关联；例如账号A-101 是由客户B 拥有，联系设定存款关联客户的账户

- E-R 模型在数据库设计中使用广泛，通常将数据库设计转化为关系模型的设计

- 实体联系模型示例：

  ![实体联系模型示例](https://raw.githubusercontent.com/MylittleTown/notes/master/Database/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86-%E6%B5%99%E5%A4%A7%E9%99%88%E5%B2%AD/Related_images/%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%AE%9E%E4%BD%93%E8%81%94%E7%B3%BB%E6%A8%A1%E5%9E%8B%E7%A4%BA%E4%BE%8B.png)

- 将E-R 图转换为关系模式，在上图设计的关系模型中，表格数据的示例（逻辑模式，逻辑层）：

  ![关系模型中表格数据示例](https://raw.githubusercontent.com/MylittleTown/notes/master/Database/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86-%E6%B5%99%E5%A4%A7%E9%99%88%E5%B2%AD/Related_images/%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B%E4%B8%AD%E8%A1%A8%E6%A0%BC%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B.png)

- 关系数据库示例（逻辑层，依据业务逻辑将逻辑模式抽象出的三张表）：

  ![关系数据库示例](https://raw.githubusercontent.com/MylittleTown/notes/master/Database/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86-%E6%B5%99%E5%A4%A7%E9%99%88%E5%B2%AD/Related_images/%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%A4%BA%E4%BE%8B.png)

- 设计视图层（子模式），即对应于应用程序的接口的表
### 数据库语言

- 数据库语言：

  - Data Definition Language（DDL，数据定义语言），指定一种数据库关系模式，作为一种关系模式的定义，指定存储结构，访问方法和一致性约束，这种语言编译后会在DBMS 中生成一种存储在特殊文件中的表，数据字典。数据字典包含元数据，包括：数据库模式，数据存储结构，访问方法和约束，统计信息，授权
  - Data Manipulation Language（DML，数据操纵语言），包括从数据库中检索数据，插入/删除/更新数据。存在两种基本的数据操作语言，过程化DML，要求用户指定需要什么数据，以及如何获得这些数据（C，Pascal，Java，......）；声明式DML也称为非过程化DML，只要求用户指定需要什么数据，而不指明如何获得这些数据（SQL，Prolog）
  - Data Control Language（DCL，数据控制语言）

- SQL（Structured Query Language，结构化查询语言） = DDL + DML + DCL 

- 数据库使用的结构

  ![用户使用数据库的结构](https://raw.githubusercontent.com/MylittleTown/notes/master/Database/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86-%E6%B5%99%E5%A4%A7%E9%99%88%E5%B2%AD/Related_images/%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%BB%93%E6%9E%84.png)

### 事务管理

- 并发的使用很重要，但也会带来一些问题
- 事务：是在数据库应用中完成单一逻辑功能的操作集合
- 事务的要求（ACID）：Atomicity（原子性，指的是事务要么执行，要么都不执行），Consistence（一致性），Isolation（隔离性，指的是两个同时在执行的事务之间没有相互影响），Durability（持久性，指的是当一个事务被正常提交之后，这个事务对数据的修改要持久）
- 事务管理组件：确保系统在出现故障（例如断电或者操作系统宕机），或者事务失败的情况下，数据库都能保持一致性（正确性）
- 并发控制管理器：控制并发事务之间的交互

### 数据库体系结构

- 存储管理器
  - 在底层数据存储与应用程序及查询之间，提供接口
  - 对数据库中的数据进行高效存储，检索与更新
  - 包括：事务管理，授权和完整性管理，文件管理（管理文件系统与数据文件，数据字典，索引文件之间的交互），缓存管理
- 查询处理器
  - 接收数据库语言输入，经过解析，优化，执行，输出相应结果给用户
  - 包括：解析和翻译；优化；执行
  - 查询处理优化：由于执行给定查询操作的方法存在很多等价表达式，每个操作有不同的实现算法，不同执行方法之间的物理开销可能是巨大的。所以需要预估操作的开销，关键取决于数据库中所维持关系的统计信息，需要预估中间结果的统计信息，这些统计信息将用于计算复杂表达式的开销。

![数据库系统的体系结构](https://raw.githubusercontent.com/MylittleTown/notes/master/Database/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86-%E6%B5%99%E5%A4%A7%E9%99%88%E5%B2%AD/Related_images/%E7%AC%AC%E4%B8%80%E7%AB%A0-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png)



  

  
